Для настройки межсетевого экрана на **FW-DT** и обеспечения правильных правил доступа для различных пользователей и устройств в офисе **DT**, можно использовать **iptables** для настройки фильтрации трафика. Ниже приведена инструкция для выполнения задачи.

### **1. Подготовка системы**

1. Убедитесь, что **FW-DT** настроен и работает.
2. Проверьте, что у вас есть доступ к командной строке устройства **FW-DT**.

### **2. Настройка правил межсетевого экрана для сервера и администраторов офиса DT**

1. **Администраторы офиса DT** должны иметь доступ ко всем устройствам в сети, включая серверы. Для этого добавьте правило, разрешающее доступ от IP-адресов администраторов ко всем устройствам.

Предположим, что IP-адреса администраторов находятся в подсети **192.168.33.0/24**.

```bash
# Разрешить доступ администраторам ко всем устройствам
sudo iptables -A INPUT -s 192.168.33.0/24 -j ACCEPT
```

2. **Сервера офиса DT** должны иметь доступ ко всем устройствам, поэтому нужно разрешить трафик с IP-адресов серверов в офисе **DT** (например, **192.168.33.0/24**).

```bash
# Разрешить доступ серверам ко всем устройствам
sudo iptables -A INPUT -s 192.168.33.0/24 -j ACCEPT
```

### **3. Настройка доступа клиентов офиса DT**

1. **Клиенты офиса DT** должны иметь доступ только к серверам, т.е. к подсети серверов **192.168.33.0/24**. Для этого добавим правило, разрешающее доступ только к серверной подсети.

Предположим, что подсеть серверов в офисе **DT** — это **192.168.33.0/24**:

```bash
# Разрешить доступ клиентам только к серверам
sudo iptables -A INPUT -s 192.168.33.0/24 -d 192.168.33.0/24 -j ACCEPT
```

2. Добавим правило, запрещающее клиентам доступ ко всем остальным устройствам.

```bash
# Запретить доступ клиентам ко всем остальным устройствам
sudo iptables -A INPUT -s 192.168.33.0/24 -j DROP
```

### **4. Разрешение ICMP-запросов администраторам**

Для того чтобы **администраторы офиса DT** могли посылать ICMP-запросы (ping) на внутренние интерфейсы межсетевого экрана, добавьте правило для разрешения ICMP.

```bash
# Разрешить ICMP-запросы администраторам
sudo iptables -A INPUT -s 192.168.33.0/24 -p icmp --icmp-type echo-request -j ACCEPT
```

### **5. Сохранение настроек iptables**

Чтобы сохранить настройки iptables и обеспечить их применение при перезагрузке системы, используйте следующие команды:

Для Debian/Ubuntu:

```bash
sudo iptables-save > /etc/iptables/rules.v4
```

Для CentOS/RHEL:

```bash
sudo service iptables save
```

### **6. Применение изменений и проверка**

1. После применения этих правил перезагрузите службу iptables или систему, чтобы изменения вступили в силу.
2. Проверьте, что все правила применились корректно:

```bash
sudo iptables -L -v
```

3. Для проверки, что **администраторы** могут подключаться ко всем устройствам, а **клиенты** — только к серверам, выполните несколько тестов:

- Попробуйте с **клиента** подключиться к серверу и убедитесь, что доступ разрешен.
- Попробуйте с **клиента** подключиться к устройствам, не являющимся серверами, и убедитесь, что доступ запрещен.
- Попробуйте с **администратора** выполнить ping (ICMP-запрос) к внутреннему интерфейсу межсетевого экрана.

### **Резюме:**

1. **Сервера и администраторы офиса DT** имеют полный доступ ко всем устройствам в сети.
2. **Клиенты офиса DT** имеют доступ только к серверам.
3. Разрешены **ICMP-запросы администраторам** на внутренние интерфейсы межсетевого экрана.
4. Все изменения сохранены для постоянного применения.
